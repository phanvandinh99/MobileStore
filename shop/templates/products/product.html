{% extends "base.html" %} {% block head %}
<link
  href="{{ url_for('static', filename='css/product-detail.css') }}"
  rel="stylesheet"
/>
{% endblock %} {% block content %} {% include 'header.html' %}
<div id="page-content" class="single-page">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <ul class="breadcrumb">
          <li><a href="{{url_for('home')}}">Home</a></li>
          <li>
            <a href="{{url_for('get_all_category')}}"
              >{{product.category.name}}</a
            >
          </li>
          <li><a href="#">{{product.name}}</a></li>
        </ul>
      </div>
    </div>

    <div class="row">
      <div id="main-content" class="col-md-8">
        <div class="product">
          <div class="col-md-6">
            <div class="image">
              <div class="product-img">
                <ul class="row">
                  <div id="b_image">
                    <img
                      src="{{ url_for('static', filename='images/'+product.image_2) }}"
                      alt="{{ product.name}}"
                    />
                  </div>
                  <div class="product-content" id="s_image">
                    <li class="col-lg-3 col-sm-3 col-xs-4">
                      <img
                        src="{{ url_for('static', filename='images/'+ product.image_1) }}"
                        alt="{{ product.name}}"
                      />
                    </li>
                    <li class="col-lg-3 col-sm-3 col-xs-4">
                      <img
                        src="{{ url_for('static', filename='images/'+ product.image_2) }}"
                        alt="{{ product.name}}"
                      />
                    </li>
                    <li class="col-lg-3 col-sm-3 col-xs-4">
                      <img
                        src="{{ url_for('static', filename='images/'+ product.image_3) }}"
                        alt="{{ product.name}}"
                      />
                    </li>
                  </div>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="caption">
              <div class="name"><h3>{{product.name}}</h3></div>
              <div class="info">
                <label>Thương Hiệu: </label>
                <span>{{product.brand.name}}</span>
              </div>
              <div class="price">
                <span class="product-price"
                  >{{ (product.price - product.price*product.discount/100) | vnd
                  }}</span
                >
                {% if product.discount>0 %}
                <span class="discounted-price">{{ product.price | vnd }}</span>
                {% endif %} {% if product.discount >0 %}
                <span class="offer-price">-{{product.discount}}%</span>
                {% endif %}
              </div>
              <div class="options">
                <label>Màu sắc: </label>
                <span>{{product.colors}}</span>
              </div>
              <div class="rating">
                {% if product.id in products['average'] %} {{
                "%.1f"|format(products['average'][product.id][0]) }}/5 {% for i
                in range(products['average'][product.id][0]|int) %}
                <span class="glyphicon glyphicon-star"></span>
                {% endfor %} {% for i in
                range(products['average'][product.id][0]|int, 5) %}
                <span class="glyphicon glyphicon-star-empty"></span>
                {% endfor %} {% if products['average'][product.id][1] > 0 %} ({{
                products['average'][product.id][1] }}) {% endif %} {% else %}
                0/5 {% for i in range(5) %}
                <span class="glyphicon glyphicon-star-empty"></span>
                {% endfor %} (0) {% endif %}
              </div>
              <div>
                <form action="{{url_for('AddCart')}}" method="post">
                  <input hidden name="product_id" value="{{product.id}}" />
                  <div>
                    <label>Số lượng:</label>
                    <input
                      type="number"
                      name="quantity"
                      value="1"
                      min="1"
                      max="20"
                      size="5"
                    />
                  </div>
                  <div>
                    <label>Chọn màu:</label>
                    <select name="colors">
                      {% set colors = product.colors.split(',') %} {% for color
                      in colors %} {% set col = color.split(':') %}
                      <option value="{{col[0]}}">
                        {{col[0] | capitalize }}
                      </option>
                      {% endfor %}
                    </select>
                  </div>
                  <div class="detail-btn">
                    <a href="#" class="product-btn btn-like">
                      <i class="fa fa-heart"></i> Yêu thích
                    </a>
                    <button type="submit" class="product-btn btn-cart">
                      <i class="fa fa-shopping-cart"></i> Thêm vào giỏ
                    </button>
                  </div>
                </form>
              </div>
              <div class="share">
                <strong>Chia sẻ:</strong>
                <a href="#" class="share-btn" target="_blank">
                  <i class="fa fa-twitter"></i> Twitter
                </a>
                <a href="#" class="share-btn" target="_blank">
                  <i class="fa fa-facebook"></i> Facebook
                </a>
                <a href="#" class="share-btn" target="_blank">
                  <i class="fa fa-linkedin"></i> LinkedIn
                </a>
              </div>
            </div>
          </div>
        </div>
        <div class="product-desc">
          <ul class="nav nav-tabs">
            <li class="active">
              <a href="#description" role="tab" data-toggle="tab">Mô tả</a>
            </li>
            <li><a href="#review" role="tab" data-toggle="tab">Đánh giá</a></li>
          </ul>
          <div class="tab-content">
            <div id="description" class="tab-pane fade in active">
              <p>{{product.desc}}</p>
            </div>
            <div id="review" class="tab-pane fade">
              <div class="review-form">
                {% if rates|length == 0 %}
                <h4>Chưa có đánh giá nào.</h4>
                {% else %} {% for rate in rates %} {% if product.id ==
                rate.product_id %}
                <div>
                  <div style="font-weight: bold; color: black">
                    {{rate.register.username}}:
                  </div>
                  <div>
                    <div class="rating" style="color: #ffc107">
                      {% for i in range(1,rate.rate_number+1) %}
                      <span class="glyphicon glyphicon-star"></span>
                      {% endfor %} {% for i in range(rate.rate_number,5) %}
                      <span class="glyphicon glyphicon-star-empty"></span>
                      {% endfor %}
                    </div>
                  </div>
                  <div>{{rate.desc}}</div>
                </div>
                <div style="text-align: right">{{rate.time}}</div>
                <div style="margin-top: -20px; text-align: center">
                  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
                  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
                  - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
                </div>
                {% endif %} {% endfor %} {% endif %} {% if kt %}
                <h4>
                  Cảm ơn bạn đã đánh giá. Bạn chỉ có thể đánh giá một lần.
                </h4>
                {% else %}
                <h4>Đánh giá sản phẩm của bạn:</h4>
                <div>
                  {% from "_formhelpers.html" import render_field %}
                  <form
                    action="{{url_for('addrate')}}"
                    method="POST"
                    enctype="multipart/form-data"
                  >
                    <input
                      type="text"
                      name="register_id"
                      value="{{customer.id}}"
                      hidden
                    />
                    <input
                      type="text"
                      name="product_id"
                      value="{{product.id}}"
                      hidden
                    />
                    <div class="rating" style="margin-top: -10px">
                      <a
                        class="glyphicon glyphicon-star-empty"
                        style="color: #ffc107"
                        onclick="test1()"
                        id="1"
                      >
                      </a>
                      <a
                        class="glyphicon glyphicon-star-empty"
                        style="color: #ffc107"
                        onclick="test2()"
                        id="2"
                      >
                      </a>
                      <a
                        class="glyphicon glyphicon-star-empty"
                        style="color: #ffc107"
                        onclick="test3()"
                        id="3"
                      >
                      </a>
                      <a
                        class="glyphicon glyphicon-star-empty"
                        style="color: #ffc107"
                        onclick="test4()"
                        id="4"
                      >
                      </a>
                      <a
                        class="glyphicon glyphicon-star-empty"
                        style="color: #ffc107"
                        onclick="test5()"
                        id="5"
                      >
                      </a>
                      <input
                        type="hidden"
                        name="select"
                        id="select"
                        value="5"
                      />
                    </div>
                    <textarea
                      rows="4"
                      cols="93"
                      name="desc"
                      style="margin-top: 10px"
                    ></textarea>
                    {% if customer == None %}
                    <h4 style="margin-top: 15px">
                      Bạn cần
                      <a
                        href="{{url_for('customer_login_page', page='rate', id=product.id)}}"
                        style="color: #667eea; font-weight: 600"
                        >đăng nhập
                      </a>
                      để đánh giá
                    </h4>
                    {% else %}
                    <input
                      class="btn btn-default"
                      style="margin-top: 15px"
                      type="submit"
                      value="Gửi đánh giá"
                    />
                    {% endif %}
                  </form>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        <div class="product-related">
          <div class="heading"><h2>SẢN PHẨM LIÊN QUAN</h2></div>
          <div class="products">
            {% for product in products["hot"] %}
            <div class="col-lg-4 col-md-4 col-xs-12">
              <div class="product-block" style="height: 450px">
                <div class="product-img">
                  <img
                    src="{{ url_for('static', filename='images/'+product.image_2) }}"
                    alt="{{ product.name}}"
                    style="height: 152px; weight: 152px"
                  />
                </div>
                <div class="product-content" style="margin-top: -20">
                  <div>
                    <h5 style="height: 35px; margin-top: -10">
                      <a
                        href="{{url_for('detail', id = product.id)}}"
                        class="product-title"
                      >
                        {{ product.name }}</a
                      >
                    </h5>
                  </div>
                  <div class="product-meta">
                    <div style="height: 60px">
                      <a href="#" class="product-price"
                        >{{ (product.price - product.price*product.discount/100)
                        | vnd }}</a
                      >
                      {% if product.discount>0 %}
                      <a href="#" class="discounted-price"
                        >{{ product.price | vnd }}</a
                      >
                      {% endif %} {% if product.discount >0 %}
                      <span class="offer-price">{{product.discount}}%off</span>
                      {% else %}
                      <span class="offer-price"></span>
                      {% endif %}
                    </div>

                    <div class="shopping-btn">
                      <form action="{{url_for('AddCart')}}" method="post">
                        <a href="#" class="product-btn btn-like"
                          ><i class="fa fa-heart"></i
                        ></a>
                        <button href="#" class="product-btn btn-cart">
                          <i class="fa fa-shopping-cart"></i>
                        </button>
                        <br />
                        <input
                          type="hidden"
                          name="product_id"
                          value="{{product.id}}"
                        />
                        <input
                          type="hidden"
                          name="quantity"
                          value="1"
                          min="1"
                          max="20"
                        />
                        {% set colors = product.colors.split(',') %}
                        <select name="colors" style="visibility: hidden">
                          {% for color in colors %} {% set col =
                          color.split(':') %}
                          <option value="{{col[0]}}">
                            {{col[0] | capitalize }}
                          </option>
                          {% endfor %}
                        </select>
                      </form>
                    </div>
                    <div>
                      <div
                        class="rating pt-3"
                        style="color: #ffc107; margin-top: -20"
                      >
                        {% if product.id in products['average'] %} {{
                        "%.1f"|format(products['average'][product.id][0]) }}/5
                        {% for i in
                        range(products['average'][product.id][0]|int) %}
                        <span class="glyphicon glyphicon-star"></span>
                        {% endfor %} {% for i in
                        range(products['average'][product.id][0]|int, 5) %}
                        <span class="glyphicon glyphicon-star-empty"></span>
                        {% endfor %} {% if products['average'][product.id][1] >
                        0 %} ({{ products['average'][product.id][1] }}) {% endif
                        %} {% else %} 0/5 {% for i in range(5) %}
                        <span class="glyphicon glyphicon-star-empty"></span>
                        {% endfor %} (0) {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          <div class="clear"></div>
        </div>
      </div>
      <!--a aaa====================================a-->
      <div id="sidebar" class="col-md-4">
        <div class="widget wid-categories">
          <div class="heading"><h4>Danh Mục Sản Phẩm</h4></div>
          <div class="content">
            <ul>
              {% for category in categories %}
              <li>
                <a href="{{url_for('get_category', name=category.name)}}"
                  >{{ category.name }}</a
                >
              </li>
              {% endfor %}
            </ul>
          </div>
        </div>
        <div class="widget wid-discouts">
          <div class="heading"><h4>Khuyến Mãi</h4></div>
          <div class="content">
            <ul>
              <li>
                <a href="{{url_for('get_discount', start = 0, end = 20)}}"
                  >< 20%</a
                >
              </li>
              <li>
                <a href="{{url_for('get_discount', start = 20, end = 40)}}"
                  >20 - 40%</a
                >
              </li>
              <li>
                <a href="{{url_for('get_discount', start = 40, end = 60)}}"
                  >40 - 60%</a
                >
              </li>
              <li>
                <a href="{{url_for('get_discount', start = 60, end = 100)}}"
                  >> 60%</a
                >
              </li>
            </ul>
          </div>
        </div>
        <div class="widget wid-brand">
          <div class="heading"><h4>Thương Hiệu</h4></div>
          <div class="content">
            <ul>
              {% for brand in brands %}
              <li>
                <a href="{{url_for('get_brand', name=brand.name)}}"
                  >{{ brand.name }}</a
                >
              </li>
              {% endfor %}
            </ul>
          </div>
        </div>
        <div class="widget wid-product">
          <div class="heading"><h4>SẢN PHẨM MỚI</h4></div>
          <div class="content">
            {% for product in products['new'] %}
            <div class="product-block" style="height: 430px">
              <div class="product-img">
                <img
                  src="{{ url_for('static', filename='images/'+product.image_2) }}"
                  alt="{{ product.name}}"
                  style="
                    padding: 0 78px 0 58px;
                    width: 100%;
                    text-align: center;
                    height: 100%;
                  "
                />
              </div>
              <div class="product-content">
                <h5 style="height: 35px; margin-top: -10">
                  <a
                    href="{{url_for('detail', id = product.id)}}"
                    class="product-title"
                    >{{ product.name }}</a
                  >
                </h5>
                <div class="product-meta">
                  <a href="#" class="product-price"
                    >{{ (product.price - product.price*product.discount/100) |
                    vnd }}</a
                  >
                  {% if product.discount>0 %}
                  <a href="#" class="discounted-price"
                    >{{ product.price | vnd }}</a
                  >
                  {% endif %}
                </div>
                <div class="shopping-btn">
                  <a href="#" class="product-btn btn-like"
                    ><i class="fa fa-heart"></i
                  ></a>
                  <a href="#" class="product-btn btn-cart"
                    ><i class="fa fa-shopping-cart"></i
                  ></a>
                </div>
                <div>
                  <div
                    class="rating pt-3"
                    style="color: #ffc107; margin-top: 20"
                  >
                    {% if product.id in products['average'] %} {{
                    "%.1f"|format(products['average'][product.id][0]) }}/5 {%
                    for i in range(products['average'][product.id][0]|int) %}
                    <span class="glyphicon glyphicon-star"></span>
                    {% endfor %} {% for i in
                    range(products['average'][product.id][0]|int, 5) %}
                    <span class="glyphicon glyphicon-star-empty"></span>
                    {% endfor %} {% if products['average'][product.id][1] > 0 %}
                    ({{ products['average'][product.id][1] }}) {% endif %} {%
                    else %} 0/5 {% for i in range(5) %}
                    <span class="glyphicon glyphicon-star-empty"></span>
                    {% endfor %} (0) {% endif %}
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  // Image gallery functionality
  var b_image = document.getElementById("b_image");
  var s_image = document.getElementById("s_image").getElementsByTagName("img");

  for (var i = 0; i < s_image.length; i++) {
    s_image[i].addEventListener("click", full_image);
  }

  function full_image() {
    var ImageSRC = this.getAttribute("src");
    b_image.innerHTML = "<img src=" + ImageSRC + ">";

    // Add smooth transition effect
    b_image.style.opacity = "0";
    setTimeout(function () {
      b_image.style.opacity = "1";
    }, 150);
  }

  // Tab functionality
  $(document).ready(function () {
    $(".nav-tabs a").click(function () {
      $(this).tab("show");
    });

    // Add smooth transitions to tabs
    $(".nav-tabs a").on("show.bs.tab", function () {
      $(".tab-pane").addClass("fade");
    });
  });

  // Rating functionality with improved UX
  function test1() {
    updateStars(1);
  }
  function test2() {
    updateStars(2);
  }
  function test3() {
    updateStars(3);
  }
  function test4() {
    updateStars(4);
  }
  function test5() {
    updateStars(5);
  }

  function updateStars(rating) {
    for (var i = 1; i <= 5; i++) {
      var star = document.getElementById(i.toString());
      if (i <= rating) {
        star.className = "glyphicon glyphicon-star";
        star.style.color = "#f39c12";
      } else {
        star.className = "glyphicon glyphicon-star-empty";
        star.style.color = "#bdc3c7";
      }
    }
    document.getElementById("select").value = rating;
  }

  // Add hover effects to rating stars
  document.addEventListener("DOMContentLoaded", function () {
    for (var i = 1; i <= 5; i++) {
      var star = document.getElementById(i.toString());
      if (star) {
        star.addEventListener("mouseenter", function () {
          var rating = parseInt(this.id);
          for (var j = 1; j <= 5; j++) {
            var hoverStar = document.getElementById(j.toString());
            if (j <= rating) {
              hoverStar.style.color = "#f39c12";
            }
          }
        });

        star.addEventListener("mouseleave", function () {
          var currentRating = parseInt(document.getElementById("select").value);
          for (var j = 1; j <= 5; j++) {
            var hoverStar = document.getElementById(j.toString());
            if (j <= currentRating) {
              hoverStar.style.color = "#f39c12";
            } else {
              hoverStar.style.color = "#bdc3c7";
            }
          }
        });
      }
    }
  });

  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener("click", function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute("href"));
      if (target) {
        target.scrollIntoView({
          behavior: "smooth",
          block: "start",
        });
      }
    });
  });
</script>
{% include 'footer.html' %} {% endblock content%}

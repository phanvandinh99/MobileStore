{% extends "base.html" %}
{% block content%}
{% include 'header.html' %}

<style>
.order-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 15px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f8f9fa;
    min-height: 100vh;
}

.main-content {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 20px;
    align-items: start;
}

.order-summary {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    overflow: hidden;
}

.order-summary h3 {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    margin: 0;
    padding: 15px 20px;
    font-size: 16px;
    font-weight: 600;
}

.product-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

.product-table th {
    background: #f8f9fa;
    padding: 12px 8px;
    text-align: left;
    font-weight: 600;
    color: #495057;
    border-bottom: 1px solid #dee2e6;
    font-size: 13px;
}

.product-table td {
    padding: 10px 8px;
    border-bottom: 1px solid #f1f3f4;
    vertical-align: middle;
}

.product-table tr:hover {
    background: #f8f9fa;
}

.product-name {
    font-weight: 600;
    color: #212529;
    max-width: 200px;
}

.product-color {
    background: #e9ecef;
    padding: 3px 6px;
    border-radius: 4px;
    font-size: 11px;
    color: #6c757d;
}

.price {
    font-weight: 600;
    color: #28a745;
}

.discount {
    color: #dc3545;
    font-weight: 600;
}

.total-row {
    background: #f8f9fa;
    font-weight: 600;
}

.total-row td {
    border-bottom: none;
}

.total-amount {
    color: #007bff;
    font-size: 16px;
}

.sidebar {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.customer-info, .payment-methods {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    overflow: hidden;
}

.customer-info h3, .payment-methods h3 {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    margin: 0;
    padding: 12px 15px;
    font-size: 14px;
    font-weight: 600;
}

.payment-methods h3 {
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
}

.form-container, .payment-options {
    padding: 15px 25px;
}

.form-group {
    margin-bottom: 12px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #495057;
    font-size: 13px;
}

.form-control {
    width: 100%;
    padding: 8px 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 13px;
    transition: border-color 0.2s ease;
}

.form-control[name="CustomerAddress"] {
    min-height: 60px;
    resize: vertical;
}

.form-control:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0,123,255,0.1);
}

.form-control[readonly] {
    background: #f8f9fa;
    color: #6c757d;
}

.payment-option {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
    padding: 10px;
    border: 1px solid #e9ecef;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.payment-option:hover {
    border-color: #007bff;
    background: #f8f9fa;
}

.payment-option input[type="radio"] {
    margin-right: 10px;
    transform: scale(1.1);
}

.payment-option label {
    margin: 0;
    font-weight: 600;
    color: #495057;
    cursor: pointer;
    font-size: 13px;
}

.payment-icon {
    margin-left: auto;
    font-size: 16px;
    color: #6c757d;
}

.submit-section {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    padding: 20px 25px;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.btn-place-order {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    border: none;
    padding: 12px 30px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 2px 8px rgba(40,167,69,0.3);
    width: auto;
    min-width: 200px;
}

.btn-place-order:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(40,167,69,0.4);
}

.btn-continue {
    display: inline-block;
    margin-top: 10px;
    color: #6c757d;
    text-decoration: none;
    font-weight: 500;
    font-size: 13px;
    transition: color 0.2s ease;
}

.btn-continue:hover {
    color: #007bff;
    text-decoration: none;
}

.breadcrumb {
    background: transparent;
    padding: 0;
    margin-bottom: 20px;
    font-size: 13px;
}

.breadcrumb-item a {
    color: #007bff;
    text-decoration: none;
}

.breadcrumb-item.active {
    color: #6c757d;
}

@media (max-width: 768px) {
    .main-content {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .order-container {
        padding: 10px;
    }
    
    .product-table {
        font-size: 12px;
    }
    
    .product-table th,
    .product-table td {
        padding: 6px 4px;
    }
    
    .form-container,
    .payment-options {
        padding: 12px 20px;
    }
    
    .product-name {
        max-width: 120px;
    }
}
</style>

<div class="order-container">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{url_for('home')}}">Trang ch·ªß</a></li>
            <li class="breadcrumb-item"><a href="{{url_for('getCart')}}">Gi·ªè h√†ng</a></li>
            <li class="breadcrumb-item active">ƒê·∫∑t h√†ng</li>
        </ol>
    </nav>

    {% include '_messages.html' %}

    <div class="main-content">
        <!-- Order Summary -->
        <div class="order-summary">
            <h3>üìã T√≥m t·∫Øt ƒë∆°n h√†ng</h3>
            <table class="product-table">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>S·∫£n ph·∫©m</th>
                        <th>M√†u</th>
                        <th>Gi√°</th>
                        <th>SL</th>
                        <th>Gi·∫£m</th>
                        <th>Th√†nh ti·ªÅn</th>
                    </tr>
                </thead>
                <tbody>
                    {% for i in range(invoices|length) %}
                    {% set order_data = get_order_data(orders[i]) %}
                    {% for key, product in order_data.items() %}
                    {% set discount =(product.discount/100) * product.price |float %}
                    {% set subtotal = product.quantity|int * product.price|float %}
                    <tr>
                        <td>{{ i+1 }}</td>
                        <td class="product-name">{{product.name}}</td>
                        <td><span class="product-color">{{product.color|capitalize}}</span></td>
                        <td class="price">{{product.price | vnd}}</td>
                        <td>{{product.quantity}}</td>
                        <td class="discount">{% if product.discount %}-{{product.discount}}%{% else %}-{% endif %}</td>
                        <td class="price">{{(subtotal - discount|round(1,'floor')) | vnd}}</td>
                    </tr>
                    {% endfor %}
                    {% endfor %}
                    <tr class="total-row">
                        <td colspan="6" style="text-align: right;"><strong>T·ªïng c·ªông:</strong></td>
                        <td class="total-amount">{{subtotals | vnd}}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Customer Information -->
            <div class="customer-info">
                <h3>üë§ Th√¥ng tin ƒë·∫∑t h√†ng</h3>
                <div class="form-container">
                    <form action="{{ url_for('submit_order') }}" method="POST" onsubmit="return confirmForm();">
                        <input type="hidden" name="invoice_customer" value="{{','.join(invoices)}}">
                        
                        <div class="form-group">
                            <label>H·ªç t√™n</label>
                            <input type="text" class="form-control" value="{{customer.username}}" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" class="form-control" value="{{customer.email}}" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label>S·ªë ƒëi·ªán tho·∫°i</label>
                            <input type="text" class="form-control" value="{{customer.phone_number}}" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label>ƒê·ªãa ch·ªâ giao h√†ng <span style="color: red;">*</span></label>
                            <input type="text" class="form-control" name="CustomerAddress" 
                                   placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ giao h√†ng" required>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Payment Methods -->
            <div class="payment-methods">
                <h3>üí≥ Ph∆∞∆°ng th·ª©c thanh to√°n</h3>
                <div class="payment-options">
                    <div class="payment-option">
                        <input type="radio" id="cod" name="payment" value="cod" checked>
                        <label for="cod">Thanh to√°n khi nh·∫≠n h√†ng</label>
                        <span class="payment-icon">üí∞</span>
                    </div>
                    <div class="payment-option">
                        <input type="radio" id="vnpay" name="payment" value="vnpay">
                        <label for="vnpay">Thanh to√°n VNPAY</label>
                        <span class="payment-icon">üí≥</span>
                    </div>
                </div>
            </div>

            <!-- Submit Section -->
            <div class="submit-section">
                <button type="submit" class="btn-place-order" onclick="submitOrder()">
                    üõí ƒê·∫∂T H√ÄNG
                </button>
                <br>
                <a href="{{url_for('home')}}" class="btn-continue">
                    ‚Üê Ti·∫øp t·ª•c mua s·∫Øm
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function confirmForm() {
    return confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒë·∫∑t h√†ng?");
}

function submitOrder() {
    const address = document.querySelector('input[name="CustomerAddress"]').value;
    if (!address.trim()) {
        alert('Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ giao h√†ng!');
        return;
    }
    
    const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
    
    if (confirmForm()) {
        if (paymentMethod === 'vnpay') {
            // Redirect to VNPAY payment
            window.location.href = "{{ url_for('vnpay_payment') }}";
        } else {
            // Submit COD order
            document.querySelector('form').submit();
        }
    }
}
</script>

{% endblock content %}